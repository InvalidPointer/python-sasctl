dist: xenial  # Currently required for Python 3.7
language: python
cache: pip

python:
  - "2.7"
  - "3.4"
  - "3.5"
  - "3.6"
  - "3.7"

env:
  - PYTHONPATH=$PYTHONPATH:./src

install:
  - pip install -r test_requirements.txt

script:
  - pytest

jobs:
  include:
    - stage: test coverage
      install:
        - pip install codecov
      script:
        - codecov

    - stage: deploy documentation
      python: 3.6
      install: pip install sphinx
      script: sphinx-build -Ean -b html -j auto -D todo_include_todos=0 ./doc ./doc/_build/html ; touch ./doc/_build/html/.nojekyll
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN
        keep_history: true
        local_dir: ./doc/_build/html
        on:
          branch: master

    - stage: test package deployment
      deploy:
        provider: pypi
        server: https://test.pypi.org
        user: jlwalke2
        password:
          secure: wTwws6xBoptSsNP4Yr5/W1yRfOLmrQynnyQGmAFAlr3t9Xkf56fNLPhLN54Q3zLP+au9pb8OzNqAu2fbwXuS/rj+M/Jqy8JLICeyivVN4UNnYfc4ICJYJUk6Y1w16brzJDtVO0WuGLsR6ENp6JBBzMglCfgjGIU3zYv/bSUz0NZudXJKl03pBNQA/EFEmjqcotkSwTLcRnuYjKZvoROsH4MAgHdVz28MpzeAFRTaqJZ/u3hV6aG3BAQIezSOyDuWB4iymgh+6svxgLyTmmCgdvaS+IVT5pKSKIyv22WG8HdGMJG6FAGsHbREdpSOx2Y7Sn1gM0+AJeKH0okxCB299B2/7zcO/T9vjqV6JH8fmM+Utm3oj5LLse8ckQnVeQDAZlUgsEs4hul5V2LkvUrKklO6yaJrUnUBTBHSe08axw/LxhFhYSBPc87VqlG1bjvberLOw3FB/5BaObYFOH2KOetNJ4cIscFQvNFBQ0ZP36qrmwwa4h4YlUIRRY9ZMivPFuuTevcloKer4423/HaTi7CZU26niBma9UuORdIbc2YDLRc/DIztGBaTp7ZwNXlFfVZ8jkXYHov4aU5xKoehPFLcko1Ltii9BpH8Rv1b7GW09G3QPpB9Mx3RuG9GFQgvkD6nZI/hpyXooBphklPzG88m6EmzfGsojJlDqoPExJs=
        distributions: sdist bdist_wheel

